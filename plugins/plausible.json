{
  "$schema": "https://raw.githubusercontent.com/invoiceradar/plugins/main/schema.json",
  "id": "plausible",
  "name": "Plausible",
  "description": "Plausible provides more privacy-friendly web analytics.",
  "homepage": "https://plausible.io/",
  "configSchema": {},
  "checkAuth": [
    {
      "action": "navigate",
      "url": "https://plausible.io/settings"
    },
    {
      "action": "checkURL",
      "url": "/settings"
    }
  ],
  "startAuth": [
    {
      "action": "navigate",
      "url": "https://plausible.io/login"
    },
    {
      "action": "waitForURL",
      "url": "/sites",
      "timeout": 120000
    }
  ],
  "getDocuments": [
    {
      "action": "navigate",
      "url": "https://plausible.io/settings/billing/invoices"
    },
    {
      "action": "extractAll",
      "selector": "table tbody tr:has(a[href*='/receipt/'])",
      "variable": "item",
      "fields": {
        "date": "td:nth-child(1)",
        "total": "td:nth-child(2)",
        "url": {
          "selector": "td:nth-child(3) a",
          "attribute": "href"
        },
        "id": {
          "selector": "td:nth-child(3) a",
          "attribute": "href",
          "transform": "(url) => url.match(/receipt\\/([^\\/]+)/)?.[1]"
        }
      },
      "forEach": [
        {
          "action": "sleep",
          "duration": 2000,
          "description": "Prevent rate limiting"
        },
        {
          "action": "navigate",
          "url": "{{item.url}}"
        },
        {
          "action": "printPdf",
          "document": "{{item}}"
        }
      ]
    }
  ],
  "autofill": true
}
